<app-content-container>
  <div class="find-league">
    <div class="d-flex justify-content-start mb-3">
      <button class="btn btn-outline-primary btn-back" routerLink="/fantasy/leagues">
        <i class="fa-solid fa-arrow-left"></i>
        Return
      </button>
    </div>
    <h2 class="mb-4">Find a League</h2>
    <form [formGroup]="searchForm" (ngSubmit)="onSearch()">
      <div class="input-group mb-3">
        <input type="text" class="form-control" formControlName="query" placeholder="Search by league name..." />
        <button class="btn btn-primary-red" type="submit" [disabled]="searchForm.invalid || loading">
          <i class="fa fa-search"></i> Search
        </button>
      </div>
      <div *ngIf="searchForm.controls['query'].invalid && (searchForm.controls['query'].touched || submitted)" class="alert alert-danger">
        Please enter at least 2 characters.
      </div>
    </form>

    <div *ngIf="loading" class="text-center my-4">
      <div class="spinner-border text-primary" role="status"></div>
    </div>
    <div *ngIf="error" class="alert alert-danger mt-3">{{ error }}</div>

    <div *ngIf="results.length > 0" class="search-results mt-4">
      <div class="card mb-3" *ngFor="let league of results">
        <div class="card-body d-flex flex-column flex-md-row align-items-md-center justify-content-between">
          <div>
            <div class="fw-bold fs-5">{{ league.name }}</div>
            <div class="text-muted">{{ league.description }}</div>
            <div class="small mt-1">
              <span class="badge bg-secondary me-2">{{ league.type }}</span>
              <span>Max Players: {{ league.maxPlayersNum }}</span>
            </div>
          </div>
          <div class="mt-3 mt-md-0">
            <button class="btn btn-outline-primary btn-join" [routerLink]="['/fantasy/leagues', league.id, 'manage']">
              View / Join
            </button>
          </div>
        </div>
      </div>
      <!-- Pagination -->
      <nav *ngIf="total > pageSize" class="mt-3">
        <ul class="pagination justify-content-center">
          <li class="page-item" [class.disabled]="pageNum === 1">
            <button class="page-link" (click)="onPageChange(pageNum - 1)" [disabled]="pageNum === 1">Previous</button>
          </li>
          <li class="page-item disabled">
            <span class="page-link">Page {{ pageNum }} of {{ Math.ceil(total / pageSize) }}</span>
          </li>
          <li class="page-item" [class.disabled]="pageNum >= total / pageSize">
            <button class="page-link" (click)="onPageChange(pageNum + 1)" [disabled]="pageNum >= total / pageSize">Next</button>
          </li>
        </ul>
      </nav>
    </div>
    <div *ngIf="!loading && submitted && results.length === 0" class="alert alert-info mt-4">
      No leagues found.
    </div>
  </div>
</app-content-container>
