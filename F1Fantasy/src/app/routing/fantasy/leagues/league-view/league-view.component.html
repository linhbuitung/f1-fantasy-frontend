<app-content-container>
  <div class="d-flex justify-content-start mb-3">
    <button class="btn btn-outline-primary btn-back" routerLink="/fantasy/leagues">
      <i class="fa-solid fa-arrow-left"></i>
      Return
    </button>
  </div>
  <div class="league-view-grid">
    <!-- Left: League Info & Join Button -->
    <div class="league-view-left">
      <h2 class="mb-4">League Details</h2>
      <div *ngIf="league" class="card league-info-card mb-4">
        <div class="card-header bg-primary-red text-white">
          League Info
        </div>
        <div class="card-body">
          <div class="mb-2"><strong>Name:</strong> {{ league.name }}</div>
          <div class="mb-2"><strong>Description:</strong> {{ league.description || '-' }}</div>
          <div class="mb-2"><strong>Type:</strong> {{ league.type }}</div>
          <div class="mb-2"><strong>Owner:</strong> {{ league.owner.displayName || league.owner.email }}</div>
          <div class="mb-2"><strong>Max Players:</strong> {{ league.maxPlayersNum }}</div>
          <div class="mb-2"><strong>Players:</strong> {{playersTotal }}</div>
          <div class="btn-section d-flex gap-2 mt-3">
            <button
              class="btn btn-primary-red"
              [disabled]="isOwner || hasRequested || hasJoined || joinSubmitting"
              (click)="onJoinLeague()"
            >
              <ng-container *ngIf="isOwner">You own this league</ng-container>
              <ng-container *ngIf="hasJoined && !isOwner">Already joined</ng-container>
              <ng-container *ngIf="hasRequested && !isOwner && !hasJoined">Request sent</ng-container>
              <ng-container *ngIf="!isOwner && !hasRequested && !hasJoined && !joinSubmitting">Join League</ng-container>
              <ng-container *ngIf="joinSubmitting"><span class="spinner-border spinner-border-sm"></span> Joining...</ng-container>
            </button>
            <button
              class="btn btn-outline-danger"
              *ngIf="hasJoined && !isOwner"
              [disabled]="leaveSubmitting"
              (click)="onLeaveLeague()"
            >
              <ng-container *ngIf="leaveSubmitting"><span class="spinner-border spinner-border-sm"></span> Leaving...</ng-container>
              <ng-container *ngIf="!leaveSubmitting">Leave League</ng-container>
            </button>
          </div>
          <div *ngIf="joinSuccess" class="alert alert-success mt-2">{{ joinSuccess }}</div>
          <div *ngIf="joinError" class="alert alert-danger mt-2">{{ joinError }}</div>
          <div *ngIf="leaveSuccess" class="alert alert-success mt-2">{{ leaveSuccess }}</div>
          <div *ngIf="leaveError" class="alert alert-danger mt-2">{{ leaveError }}</div>
        </div>
      </div>
    </div>
    <!-- Right: Players in League -->
    <div class="league-view-right">
      <div class="card league-players-card mb-4">
        <div class="card-header bg-primary-red text-white">
          Players in League
        </div>
        <div class="card-body p-0">
          <div *ngIf="loadingPlayers" class="text-center my-4">
            <div class="spinner-border text-primary" role="status"></div>
          </div>
          <div *ngIf="!loadingPlayers && leaguePlayers.length > 0">
            <div class="table-responsive">
              <table class="table table-bordered table-sm m-0">
                <thead class="bg-light">
                <tr>
                  <th>Display Name</th>
                  <th>Email</th>
                  <th>Country</th>
                  <th>Point</th>
                </tr>
                </thead>
                <tbody>
                <tr *ngFor="let player of leaguePlayers">
                  <td>{{ player.displayName || '-' }}</td>
                  <td>{{ player.email }}</td>
                  <td>{{ player.countryName || '-' }}</td>
                  <td>{{ player.totalPoints }}</td>
                </tr>
                </tbody>
              </table>
            </div>
            <!-- Pagination -->
            <nav *ngIf="playersTotal > playersPageSize" class="mt-3">
              <ul class="pagination justify-content-center">
                <li class="page-item" [class.disabled]="playersPageNum === 1">
                  <button class="page-link" (click)="onPlayersPageChange(playersPageNum - 1)" [disabled]="playersPageNum === 1">Previous</button>
                </li>
                <li class="page-item disabled">
                  <span class="page-link">Page {{ playersPageNum }}</span>
                </li>
                <li class="page-item" [class.disabled]="playersPageNum * playersPageSize >= playersTotal">
                  <button class="page-link" (click)="onPlayersPageChange(playersPageNum + 1)" [disabled]="playersPageNum * playersPageSize >= playersTotal">Next</button>
                </li>
              </ul>
            </nav>
          </div>
          <div *ngIf="!loadingPlayers && leaguePlayers.length === 0" class="alert alert-info m-3">
            No players in this league.
          </div>
        </div>
      </div>
    </div>
  </div>
</app-content-container>
