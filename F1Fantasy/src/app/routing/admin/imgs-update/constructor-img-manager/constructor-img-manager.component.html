  <div class="constructor-img-manager">
    <div class="row gx-4">
      <aside class="col-lg-4 col-12">
        <div class="card sidebar-card">
          <div class="card-header">Find constructor</div>
          <div class="card-body">
            <form [formGroup]="searchForm" (submit)="$event.preventDefault(); onSearch()">
              <div class="mb-2">
                <input type="text" class="form-control" placeholder="Search by name or code" formControlName="query" />
              </div>
              <div class="d-grid">
                <button class="btn btn-search btn-sm" type="button" (click)="onSearch()">Search</button>
              </div>
            </form>

            <div class="mt-3">
              <div *ngIf="constructors?.length === 0" class="text-muted small">No results</div>
              <div *ngFor="let c of constructors" class="constructor-item" [class.selected]="selectedConstructor?.id === c.id" (click)="selectConstructor(c)">
                <div class="d-flex gap-2 align-items-center">
                  <img *ngIf="c.imgUrl; else def" [src]="c.imgUrl" alt="{{ c.name }}" class="thumb" />
                  <ng-template #def><img src="assets/steering-wheel.svg" alt="constructor" class="thumb" /></ng-template>
                  <div>
                    <div class="fw-semibold">{{ c.name }}</div>
                    <div class="small text-muted">{{ c.code }} â€¢ {{ c.price }}$</div>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>
      </aside>

      <main class="col-lg-8 col-12">
        <div class="card content-card">
          <div class="card-header">Update constructor image</div>
          <div class="card-body">
            <div *ngIf="!selectedConstructor" class="text-muted">Select a constructor from the left to start.</div>

            <div *ngIf="selectedConstructor">
              <div class="d-flex gap-3 mb-3 align-items-start">
                <div>
                  <div class="fw-semibold mb-1">{{ selectedConstructor.name }}</div>
                  <div class="small text-muted mb-2">Code: {{ selectedConstructor.code }}</div>
                  <img *ngIf="selectedConstructor.imgUrl" [src]="selectedConstructor.imgUrl" alt="current" class="current-img mb-2" />
                </div>
              </div>

              <div class="mb-3 d-flex flex-column">
                <label class="form-label">Choose image (jpg/jpeg/png, max 5 MB)</label>
                <input type="file" accept=".jpg,.jpeg,.png" (change)="onFileChange($event)" />
              </div>

              <div *ngIf="imageBase64" class="crop-area mb-3">
                <image-cropper
                  [imageBase64]="imageBase64"
                  [maintainAspectRatio]="true"
                  [aspectRatio]="1"
                  [resizeToWidth]="2048"
                  format="png"
                  [imageQuality]="1"
                  (imageCropped)="imageCropped($event)"
                ></image-cropper>
                <div *ngIf="croppedDataUrl" class="mt-2">
                  <div class="fw-semibold small">Cropped preview</div>
                  <img [src]="croppedDataUrl" class="cropped-preview" alt="cropped preview" />
                </div>
              </div>

              <div class="mt-3 d-flex gap-2">
                <button class="btn btn-upload" (click)="upload()" [disabled]="uploading">
                  {{ uploading ? 'Uploading...' : 'Upload cropped image' }}
                </button>
                <button class="btn btn-outline-secondary" (click)="selectConstructor(selectedConstructor)">Reset</button>
              </div>

              <div *ngIf="serverError" class="alert alert-danger mt-3">{{ serverError }}</div>
              <div *ngIf="successMessage" class="alert alert-success mt-3">{{ successMessage }}</div>
            </div>

          </div>
        </div>
      </main>
    </div>
  </div>
