  <div class="powerup-img-manager">
    <div class="row gx-4">
      <aside class="col-lg-4 col-12">
        <div class="card sidebar-card">
          <div class="card-header">Powerups</div>
          <div class="card-body">
            <div *ngIf="powerups.length === 0" class="text-muted small">No powerups found</div>
            <div *ngFor="let p of powerups" class="powerup-item" [class.selected]="selectedPowerup?.id === p.id" (click)="selectPowerup(p)">
              <div class="d-flex gap-2 align-items-center">
                <img *ngIf="p.imgUrl; else def" [src]="p.imgUrl" [alt]="p.type" class="thumb" />
                <ng-template #def><img src="assets/powerup.svg" alt="powerup" class="thumb" /></ng-template>
                <div>
                  <div class="fw-semibold">{{ p.type }}</div>
                  <div class="small text-muted">{{ p.description }}</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </aside>

      <main class="col-lg-8 col-12">
        <div class="card content-card">
          <div class="card-header">Update powerup image</div>
          <div class="card-body">
            <div *ngIf="!selectedPowerup" class="text-muted">Select a powerup on the left to manage its image.</div>

            <div *ngIf="selectedPowerup">
              <div class="mb-2">
                <div class="fw-semibold">{{ selectedPowerup.type }}</div>
                <div class="small text-muted mb-2">{{ selectedPowerup.description }}</div>
                <img *ngIf="selectedPowerup.imgUrl" [src]="selectedPowerup.imgUrl" alt="current" class="current-img mb-2" />
              </div>

              <div class="mb-3 d-flex flex-column">
                <label class="form-label">Choose image (jpg/jpeg/png, max 5 MB)</label>
                <input type="file" accept=".jpg,.jpeg,.png" (change)="onFileChange($event)"  />
              </div>

              <div *ngIf="imageBase64" class="crop-area mb-3">
                <image-cropper
                  [imageBase64]="imageBase64"
                  [maintainAspectRatio]="true"
                  [aspectRatio]="1"
                  [resizeToWidth]="2048"
                  format="png"
                  [imageQuality]="1"
                  (imageCropped)="imageCropped($event)"
                ></image-cropper>

                <div *ngIf="croppedDataUrl" class="mt-2">
                  <div class="fw-semibold small">Cropped preview</div>
                  <img [src]="croppedDataUrl" class="cropped-preview" alt="cropped preview" />
                </div>
              </div>

              <div class="mt-3 d-flex gap-2">
                <button class="btn btn-upload" (click)="upload()" [disabled]="uploading">
                  {{ uploading ? 'Uploading...' : 'Upload cropped image' }}
                </button>
                <button class="btn btn-outline-secondary" (click)="selectPowerup(selectedPowerup)">Reset</button>
              </div>

              <div *ngIf="serverError" class="alert alert-danger mt-3">{{ serverError }}</div>
              <div *ngIf="successMessage" class="alert alert-success mt-3">{{ successMessage }}</div>
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>
